{
  "name": "Message Tracker Template Playground",
  "enabled": true,
  "html": "<div class=\"topbar\">\n                <div class=\"tabs\">\n                  <!-- Main -->\n                  <button class=\"tab tab-icon\" data-target=\"#sec-main\" aria-label=\"Main Characters\">\n                    <span class=\"tab-ico\" data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/main.svg\"></span>\n                  </button>\n\n                  <!-- Others -->\n                  <button class=\"tab tab-icon\" data-target=\"#sec-others\" aria-label=\"Other Characters\">\n                    <span class=\"tab-ico\" data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/other-characters.svg\"></span>\n                  </button>\n\n                  <!-- Enemies -->\n                  <button class=\"tab tab-icon\" data-target=\"#sec-enemies\" aria-label=\"Enemies\">\n                    <span class=\"tab-ico\" data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/enemies.svg\"></span>\n                  </button>\n                </div>\n                \n                <div class=\"topbar-right\">\n                  <span class=\"kv-ico time-ico\" data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/time.svg\"></span>\n                  <span class=\"time\">{{Time}}</span>\n                </div>\n              </div>\n\n              <!-- MAIN -->\n              <section id=\"sec-main\" class=\"section\">\n                <div class=\"cards\">\n                  {{#foreach MainCharacters mainCharacter}}\n                  <article class=\"card\" data-card>\n                    <header class=\"hd hd-main\">\n                      <div class=\"name blue\">{{mainCharacter}}</div>\n                      <div class=\"lvl pill\">LV {{mainCharacter.Level}}</div>\n                      <div class=\"role\">{{mainCharacter.Role}}</div>\n                    </header>\n\n                    <div class=\"bars-main\">\n                      <div class=\"labelblock\">\n                        <div class=\"labeltext hp-line\">\n                          HP: {{mainCharacter.HP}}\n                        </div>\n                      </div>\n                      <div class=\"labelblock\">\n                        <div class=\"labeltext exp-line\">\n                          EXP: {{mainCharacter.Exp}}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div class=\"groups\">\n                      <div class=\"icon-row\" data-hoverbar>\n                        <div\n                          class=\"ic\"\n                          data-id=\"stats\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/stat-1.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"inventory\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/inventory.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"finance\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/finance.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"posture\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/posture-sensory.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"appearance\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/characters-main-appearance.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"injury\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/injury.svg\"\n                        ></div>\n                      </div>\n                      <div class=\"icon-row right\" data-hoverbar>\n                        <div\n                          class=\"ic\"\n                          data-id=\"location\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/location.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"weather\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/weather.svg\"\n                        ></div>\n                        <span class=\"income-text\"\n                          >{{mainCharacter.Income}}</span\n                        >\n                      </div>\n                    </div>\n\n                    <div class=\"balloon\">\n                      <div class=\"content\" data-id=\"stats\">\n                        {{mainCharacter.Stats}}\n                      </div>\n                      <div class=\"content\" data-id=\"inventory\">\n                        <div class=\"kv\">\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/items.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Items}}</div>\n                          </div>\n\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/weapons.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Weapons}}</div>\n                          </div>\n\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/ammos-1.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Ammos}}</div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"content\" data-id=\"finance\">\n                        <div class=\"kv\">\n                          <!-- Cash -->\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/cash.svg\"\n                            ></span>\n                            <div class=\"kv-text\">{{mainCharacter.Cash}}</div>\n                          </div>\n\n                          <!-- Savings -->\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/piggy-bank.svg\"\n                            ></span>\n                            <div class=\"kv-text\">{{mainCharacter.Savings}}</div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"content\" data-id=\"posture\">\n                        <div class=\"kv\">\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/posture.svg\"\n                            ></span>\n                            <div>{{mainCharacter.PostureAndInteraction}}</div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/sensory.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Sensory}}</div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"content\" data-id=\"appearance\">\n                        <div class=\"kv\">\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/outfit.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Outfit}}</div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/state-of-dress.svg\"\n                            ></span>\n                            <div>{{mainCharacter.StateOfDress}}</div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/hair-2.svg\"\n                            ></span>\n                            <div>{{mainCharacter.Hair}}</div>\n                          </div>\n                        </div>\n                      </div>\n                      <div class=\"content\" data-id=\"injury\">\n                        {{mainCharacter.InjuryAilments}}\n                      </div>\n                      <div class=\"content\" data-id=\"location\">\n                        {{mainCharacter.Location}}\n                      </div>\n                      <div class=\"content\" data-id=\"weather\">\n                        {{mainCharacter.Weather}}\n                      </div>\n                    </div>\n                  </article>\n                  {{/foreach}}\n                </div>\n              </section>\n\n              <!-- OTHERS -->\n              <section id=\"sec-others\" class=\"section\">\n                <div class=\"cards\">\n\t\t  \n\t\t              {{#foreach OtherCharacters otherCharacter}}\n                  <article class=\"card\" data-card>\n                    <header class=\"hd hd-basic\">\n                      <div class=\"name white\">{{otherCharacter}}</div>\n                      <div class=\"role\" style=\"margin-left: auto\">\n                        {{otherCharacter.Role}}\n                      </div>\n                    </header>\n                    <div class=\"split\">\n                      <div class=\"labelblock\">\n                        <div class=\"labeltext hp-line\">HP: {{otherCharacter.HP}}</div>\n                      </div>\n                      <div class=\"icon-row right\" data-hoverbar>\n                        <div class=\"ic-pair\">\n                          <div\n                            class=\"ic\"\n                            data-id=\"location\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/location.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"weather\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/weather.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"injury\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/injury.svg\"\n                          ></div>\n                        </div>\n\n                        <div\n                          class=\"ic\"\n                          data-id=\"items\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/inventory.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"cash\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/finance.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"posture\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/posture-sensory.svg\"\n                        ></div>\n                        <div\n                          class=\"ic\"\n                          data-id=\"appearance\"\n                          data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/characters-main-appearance.svg\"\n                        ></div>\n                      </div>\n                    </div>\n\n                    <div class=\"balloon\">\n                      <div class=\"content\" data-id=\"location\">\n                        {{otherCharacter.Location}}\n                      </div>\n                      <div class=\"content\" data-id=\"weather\">\n                        {{otherCharacter.Weather}}\n                      </div>\n                      <div class=\"content\" data-id=\"injury\">\n                        {{otherCharacter.InjuryAilments}}\n                      </div>\n                      <div class=\"content\" data-id=\"items\">\n                        {{otherCharacter.Items}}\n                      </div>\n                      <div class=\"content\" data-id=\"cash\">\n                        {{otherCharacter.Cash}}\n                      </div>\n\n                      <div class=\"content\" data-id=\"posture\">\n                        <div class=\"kv\">\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/posture.svg\"\n                            ></span>\n                            <div>{{otherCharacter.PostureAndInteraction}}</div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/sensory.svg\"\n                            ></span>\n                            <div>\n                              {{otherCharacter.Sensory}}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div class=\"content\" data-id=\"appearance\">\n                        <div class=\"kv\">\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/outfit.svg\"\n                            ></span>\n                            <div>\n                              {{otherCharacter.Outfit}}\n                            </div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/state-of-dress.svg\"\n                              ></span\n                            >\n                            <div>{{otherCharacter.StateOfDress}}</div>\n                          </div>\n                          <div class=\"kv-row\">\n                            <span\n                              class=\"kv-ico\"\n                              data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/hair.svg\"\n                            ></span>\n                            <div>{{otherCharacter.Hair}}</div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </article>\n\t\t              {{/foreach}}\n\n                </div>\n              </section>\n\n              <!-- ENEMIES -->\n              <section id=\"sec-enemies\" class=\"section\">\n                <div class=\"enemies-wrap\">\n                  <div class=\"enemies-grid\" id=\"enemies-grid\">\n                    <!-- Small Enemy -->\n\n\t\t                {{#foreach SmallEnemies smallEnemy}}\n                                {{#if smallEnemy}}\n                    <article\n                      class=\"enemy-card card\"\n                      data-card\n                      data-size=\"small\"\n                    >\n                      <header class=\"hd hd-small\">\n                        \n                        <div class=\"small-name name red\">\n                          {{smallEnemy}}\n                        </div>\n                        <div class=\"small-number\">{{smallEnemy.Number}}</div>\n                        <span class=\"pill small-exp\">{{smallEnemy.ExpGain}}</span>\n                      </header>\n                      <div class=\"groups\" style=\"padding-top: 6px\">\n                        <div class=\"icon-row\" data-hoverbar>\n                          <div\n                            class=\"ic\"\n                            data-id=\"location\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/location.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"appearance\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/enemies-appearance.svg\"\n                          ></div>\n                        </div>\n                      </div>\n                      <div class=\"balloon\">\n                        <div class=\"content\" data-id=\"location\">\n                          {{smallEnemy.Location}}\n                        </div>\n                        <div class=\"content\" data-id=\"appearance\">\n                          {{smallEnemy.Appearance}}\n                        </div>\n                      </div>\n                    </article>\n                                {{/if}}\n\t\t                {{/foreach}}\n\n                    \n                    <!-- Big Enemy -->\n\t\t                {{#foreach BigEnemies bigEnemy}}\n                                {{#if bigEnemy}}\n                    <article\n                      class=\"enemy-card card big-50\"\n                      data-card\n                      data-size=\"big\"\n                    >\n                      <header class=\"hd hd-quad\">\n                        <div class=\"name purple quad-name\">\n                          {{bigEnemy}}\n                        </div>\n                        <span class=\"pill quad-exp\">{{bigEnemy.ExpGain}}</span>\n                        <div class=\"quad-lvl pill\">Lv {{bigEnemy.Level}}</div>\n                        <div class=\"quad-type\">Type: {{bigEnemy.Type}}</div>\n                      </header>\n\n                      <div class=\"split\">\n                        <div class=\"labelblock\">\n                          <div class=\"labeltext hp-line\">HP: {{bigEnemy.HP}}</div>\n                        </div>\n                        <div class=\"icon-row right\" data-hoverbar>\n                          <div\n                            class=\"ic\"\n                            data-id=\"injury\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/injury.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"location\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/location.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"ability\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/big-enemies-ability.svg\"\n                          ></div>\n                          <div\n                            class=\"ic\"\n                            data-id=\"appearance\"\n                            data-svg=\"/scripts/extensions/third-party/SillyTavern-Tracker/icons/enemies-appearance.svg\"\n                          ></div>\n                        </div>\n                      </div>\n\n                      <div class=\"balloon\">\n                        <div class=\"content\" data-id=\"injury\">\n                          {{bigEnemy.Ailments}}\n                        </div>\n                        <div class=\"content\" data-id=\"location\">\n                          {{bigEnemy.Location}}\n                        </div>\n                        <div class=\"content\" data-id=\"ability\">\n                          {{bigEnemy.Ability}}\n                        </div>\n                        <div class=\"content\" data-id=\"appearance\">\n                          {{bigEnemy.Appearance}}\n                        </div>\n                      </div>\n                    </article>\n                                {{/if}}\n\t\t                {{/foreach}}\n\n                  </div>\n                </div>\n              </section>\n\n              <!----------------------------  ------------------------------>\n              <!-- TRACKER CONTENT End-->\n              <!----------------------------  ------------------------------>",
  "css": "\n/**************************** TRACKER NEW!! — START ******************************/\n\t\t.mes_tracker {\n\t\tpadding-top: 0 !important;\n\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t:root {\n        --bg: #0d1422;\n        --panel: rgba(72, 79, 107, 0.56);\n        --panel-1: rgba(22, 22, 34, 0.42);\n        --panel-2: rgba(32, 36, 49, 0.71);\n        --panel-3: rgba(22, 22, 34, 0.42); /* for enemy cards */\n        --panel-4: rgba(68, 68, 68, 0.05); /* for top buttons */\n        --panel-5: rgb(143 102 102 / 28%); /* for top buttons hover*/\n        --ink: #d7e3ff;\n        --ink-dim: #bbbbbbe5;\n        --accent: #4aa8ff;\n        --accent-2: #7cc6ff;\n        --accent-3: #ff7799; /* pink */\n        --accent-4: #ffa8be; /*top button hover*/\n        --ok: #22ff85;\n        --warn: #ffb44d;\n        --bad: #ff5a6a;\n        --exp: #69b7ff;\n        --border: rgba(255, 255, 255, 0.08);\n        --muted: rgba(255, 255, 255, 0.06);\n        --radius: 8px;\n        --fade: 200ms ease;\n      }\n\t\n      .role,\n      .income-text,\n      .pill,\n      .small-number,\n      .quad-type {\n        font-size: 10px !important;\n      }\n\n      .topbar {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 10px 18px 10px;\n        margin-bottom: 6px;\n        border-bottom: 1px solid var(--border);\n        /*position: sticky;*/\n        top: 0;\n        z-index: 5;\n      }\n\n      .tabs {\n        display: flex;\n        gap: 6px;\n      }\n\n      .tab.tab-icon {\n        width: 24px;\n        height: 22px;\n        padding: 0;\n        border-radius: 8px;\n        display: inline-grid;\n        place-items: center;\n        background: var(--panel-4);\n        border: 1px solid var(--border);\n        color: var(--accent-3);\n        cursor: pointer;\n        user-select: none;\n        transition: background var(--fade), transform 0.06s ease,\n          border-color var(--fade);\n      }\n\n      .tab.tab-icon:hover,\n      .tab.tab-icon.active {\n        background: var(--panel-5) !important;\n        color: var(--accent-4) !important;\n        box-shadow: 0 0 2px 0.5px var(--accent-4);\n        \n      }\n      \n      .tab.tab-icon:hover {\n        transform: translateY(-1px);\n      }\n      .tab.tab-icon.active {\n        /* outline: 1px solid var(--accent); */\n        border-color: transparent;\n      }\n      \n\n      /* size/fit the svg/img */\n      .tab-ico svg,\n      .tab-ico img {\n        width: 11px;\n        height: 11px;\n        display: block;\n        object-fit: contain;\n      }\n\n      /* set the button/icon color (currentColor) */\n     /* .tab.tab-icon {\n        color: #b7d8ff;\n      }*/ \n      \n      /* default */\n      /*.tab.tab-icon:hover {\n        color: #d7e6ff;\n      }*/\n      \n      /*.tab.tab-icon.active {\n        color: #9cc9ff;\n      }*/\n\n      /* make ALL children of the inline SVG use currentColor */\n      .tab-ico svg,\n      .tab-ico svg * {\n        fill: currentColor !important;\n        stroke: currentColor !important;\n      }\n\n      /* preserve explicit \"none\" from the original icon */\n      .tab-ico svg [fill=\"none\"] {\n        fill: none !important;\n      }\n      .tab-ico svg [stroke=\"none\"] {\n        stroke: none !important;\n      }\n\n      .clock {\n        color: var(--ink-dim);\n        font-weight: 600;\n      }\n\t\n\t\t\t\t\t\t\n      \n      .topbar-right {\n        display: flex;\n        gap: 8px;\n      }\n\n      .kv-ico.time-ico {\n        color: var(--ink-dim);\n      }\n\n      .time {\n        color: var(--ink-dim);\n        font-size: 12px !important;\n\t\tletter-spacing: 0.75px;\n\t\tfont-weight: 500;\n      }\n\n      .section {\n        display: none;\n        padding: 6px 0;\n        position: relative;\n        z-index: 0;\n      }\n      .section.show {\n        display: block;\n      }\n\n      .cards {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 14px;\n      }\n\n      .mes_tracker .card {\n        position: relative;\n        background: var(--panel);\n        border-radius: var(--radius);\n        overflow: visible;\n        /* padding-bottom: 12px; */\n        padding: 0 12px;\n      }\n\n      /* pick your priority (higher → on top) */\n      #sec-enemies {\n        z-index: 10;\n      }\n      #sec-others {\n        z-index: 20;\n      } /* sits above enemies */\n      #sec-main {\n        z-index: 30;\n      } /* sits above both */\n\n      #sec-main .card,\n      .enemy-card[data-size=\"small\"] {\n        padding-bottom: 0 !important;\n      }\n\n      .card.raised {\n        z-index: 50;\n      }\n\n      /* HEADERS */\n      .hd {\n        padding: 12px 0 5px;\n        border-bottom: 1px solid var(--muted);\n      }\n      /* Main: Name (flex) | Level (auto) | Role (flex) with ellipsis */\n      .hd-main {\n        display: grid;\n        grid-template-columns: minmax(0, 1.3fr) max-content minmax(0, 1.7fr);\n        align-items: center;\n        gap: 12px;\n        /* easy to tweak later */\n        --name-col: 30%;\n        --lvl-col: 10%;\n        --role-col: 60%;\n\n        /* Name | Level | Role */\n        grid-template-columns:\n          minmax(0, var(--name-col))\n          minmax(56px, var(--lvl-col)) /* keep the pill from squishing */\n          minmax(0, var(--role-col));\n      }\n\n      /* keep text from bleeding */\n      .hd-main .name,\n      .hd-main .role {\n        min-width: 0;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      /* level pill centered and single-line */\n      .hd-main .lvl {\n        justify-self: center;\n        white-space: nowrap;\n      }\n\n      .hd-basic {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\t\t\t\t\t\t\n\n      .name {\n        font-weight: 400;\n        letter-spacing: 0.35px;\n        min-width: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-size: 14px;\n      }\n      .name.blue {\n        color: var(--accent-2);\n      }\n      .name.white {\n        color: #bbb;\n      }\n      .name.red {\n        color: #ff3b3b;\n      }\n      .name.purple {\n        color: #6e6bff;\n      }\n      .lvl.pill,\n      .quad-lvl.pill {\n        justify-self: left;\n        background: none !important;\n        color: #c2c2c2;\n        border: none;\n        font-weight: 600;\n      }\n      .role {\n        justify-self: end;\n        color: var(--ink-dim);\n        min-width: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      .pill,\n      .tag {\n        font-size: 12px;\n        background: #3f3228;\n        color: #e9a949;\n        border: 0.5px solid #e9a94973;\n        padding: 2px 7px;\n        border-radius: 999px;\n      }\n\n      /* --- Small enemy header: 2 rows to match big enemy --- */\n      .hd-small {\n        display: grid;\n        grid-template-columns: minmax(0, 1fr) auto;\n        grid-template-areas:\n          \"name name\"\n          \"number exp\";\n        gap: 6px 12px;\n        align-items: center;\n      }\n      .small-name {\n        grid-area: name;\n        min-width: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      .small-number {\n        grid-area: number;\n        color: var(--ink-dim);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      .small-exp {\n        grid-area: exp;\n        justify-self: end;\n      }\n\n      /* BARS */\n      .labelblock {\n        display: grid;\n        gap: 6px;\n      }\n      .labeltext {\n        font-size: 9px;\n        letter-spacing: 0.7px;\n        color: var(--ink-dim);\n        padding-bottom: 4px;\n      }\n\t\t\t\t\t\t\n\t  /* make each card its own compositing island so glows render consistently */\n\t  .mes_tracker .card{ isolation:isolate; }\t\t\t\t\n\t\t\t\t\t\t\n      .bar {\n        height: 1px !important;\n        background: var(--panel-2);\n        border-radius: 999px;\n        overflow: visible;\n\t\tposition: relative;\n        /*border: 1px solid var(--muted);*/\n      }\n      \n      .bar > span {\n        display: block;\n        height: 100%;\n\t    position: relative;\n\t\twill-change: filter;\n        width: 0%;\n      }\n      \n  \t  .bar.hp.ok {\n        box-shadow: 0 0 5px var(--ok) !important;\n      }\n      \n      .bar.hp.warn {\n        box-shadow: 0 0 5px var(--warn)  !important;\n      }\n      \n      .bar.hp.bad {\n        box-shadow: 0 0 5px var(--bad)  !important;\n      }\n      \n      .bar.exp {\n        box-shadow: 0 0 4px var(--exp)  !important;\n      }\n      \n      .hp.ok > span {\n        background: linear-gradient(90deg, var(--ok), #00d08a)  !important;\n\t\tbox-shadow: 0 0 3px var(--ok)  !important;\n\t\tfilter: drop-shadow(0 0 5px var(--ok))  !important;\n      }\n      .hp.warn > span {\n        background: linear-gradient(90deg, #ffb44d, #ffd56b)  !important;\n\t\tfilter: drop-shadow(0 0 5px var(--warn))  !important;\n\t\tbox-shadow: 0 0 3px var(--warn)  !important;\n      }\n      .hp.bad > span {\n        background: linear-gradient(90deg, #ff5a6a, #ff808a)  !important;\n\t\tfilter: drop-shadow(0 0 5px var(--bad))  !important;\n\t\tbox-shadow: 0 0 3px var(--bad)  !important;\n      }\n      .exp > span {\n        background: linear-gradient(90deg, rgb(84 173 255), rgb(182 225 255))  !important;\n\t\tfilter: drop-shadow(0 0 5px var(--exp))  !important;\n\t\tbox-shadow: 0 0 4px var(--exp)  !important;\n\t  }\n      .bars-main {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n        padding: 5px 0px;\n        border-bottom: 1px solid var(--muted);\n      }\n      .split {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n        padding: 5px 0px;\n      }\n\n      /* ICONS & INCOME */\n      .groups {\n        display: flex;\n        justify-content: space-between;\n        gap: 12px;\n        padding: 5px 0px;\n      }\n\n      .icon-row {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n        flex-wrap: wrap;\n      }\n\n      .icon-row.right {\n        margin-left: auto;\n        justify-content: flex-end;\n      }\n\n      .ic-pair {\n        display: flex;\n        gap: 1px;\n      }\n\n      /* fix gap only for Main right row */\n      #sec-main .icon-row.right {\n        gap: 1px;\n      }\n\n      .income-text {\n        margin-left: auto;\n        color: var(--ink-dim);\n        padding: 4px 5px;\n      }\n\n      .ic {\n        background: var(--panel-2);\n        border: 1px solid var(--border);\n        width: 22px;\n        height: 22px;\n        border-radius: 4px;\n        display: grid;\n        place-items: center;\n        cursor: pointer;\n        transition: background var(--fade), transform 0.06s ease,\n          border-color var(--fade);\n        font-size: 18px;\n\n        svg {\n          width: 11px !important;\n          height: 11px !important;\n        }\n      }\n\n      .ic:hover {\n        background: #1b2943;\n        transform: translateY(-1px);\n      }\n\n      .ic.active {\n        outline: 1px solid var(--accent);\n        border-color: transparent;\n      }\n\n      /* Base tint for in-card icons */\n      .ic {\n        color: #939393;\n      } /* default */\n      .ic:hover,\n      .ic.active {\n        color: #83c3ff;\n      }\n\n      /* Specific Color for Main and Others section */\n      #sec-main,\n      #sec-others {\n        .ic[data-id=\"location\"],\n        .ic[data-id=\"weather\"] {\n          color: #e99e54;\n          background: none;\n          border: none;\n          svg {\n            width: 15px !important;\n            height: 15px !important;\n            row-gap: 0px !important;\n          }\n        }\n\t\t\t\t\t\t\t\t\n\t   .ic[data-id=\"injury\"] svg {\n\t\tcolor: rgb(148 226 149);\n\t\t}\n\n        .ic[data-id=\"location\"]:hover,\n        .ic[data-id=\"location\"].active,\n        .ic[data-id=\"weather\"]:hover,\n        .ic[data-id=\"weather\"].active {\n          color: #ffc068;\n          outline: none;\n        }\n      }\n\n      /* Specific Color for Enemies section */\n      #sec-enemies .ic {\n        color: #78bbeb;\n        /* background: rgba(73, 82, 113, 0.71); */\n\n        .ic[data-id=\"location\"] svg {\n          width: 15px !important;\n          height: 15px !important;\n        }\n\n        .ic[data-id=\"appearance\"] svg {\n          width: 12px !important;\n          height: 12px !important;\n        }\n\n        .ic[data-id=\"location\"]:hover,\n        .ic[data-id=\"location\"].active,\n        .ic[data-id=\"appearance\"]:hover,\n        .ic[data-id=\"appearance\"].active {\n          color: #ffc068;\n          outline: none;\n        }\n      }\n\n      /* Base tint for balloon icons */\n      .kv-ico {\n        color: #ffc870;\n      }\n\n      /* Force inline SVGs to follow currentColor */\n      .ic svg,\n      .kv-ico svg {\n        width: 16px;\n        height: 16px;\n        display: block;\n      }\n      .ic svg *,\n      .kv-ico svg * {\n        fill: currentColor !important;\n        stroke: currentColor !important;\n      }\n      /* keep explicit ‘none’ intact */\n      .ic svg [fill=\"none\"],\n      .kv-ico svg [fill=\"none\"] {\n        fill: none !important;\n      }\n      .ic svg [stroke=\"none\"],\n      .kv-ico svg [stroke=\"none\"] {\n        stroke: none !important;\n      }\n\n      .ic img {\n        width: 20px;\n        height: 20px;\n        display: block;\n      }\n\n      /* Finance balloon: two kv items side-by-side */\n      .kv-2col {\n        display: grid;\n        grid-template-columns: 22px 2fr 22px 3fr;\n        column-gap: 5px;\n        row-gap: 0;\n        align-items: center;\n      }\n\n      .kv-ico svg {\n        place-self: center;\n        width: 13px;\n        height: 13px;\n      }\n\n      /* Stack on narrow screens */\n      @media (max-width: 600px) {\n        .kv-2col {\n          grid-template-columns: 22px 1fr;\n          row-gap: 10px;\n        }\n      }\n\n      /* Balloon */\n      .balloon {\n        position: absolute;\n        left: 14px;\n        right: 14px;\n        top: calc(100% + 8px);\n        background: rgb(61 84 88 / 50%);\n        border: 1px solid var(--border);\n        border-radius: 12px;\n        padding: 12px;\n        -webkit-backdrop-filter: blur(8px);\n        backdrop-filter: blur(8px);\n        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.45);\n        opacity: 0;\n        transform: translateY(8px);\n        pointer-events: none;\n        transition: opacity var(--fade), transform var(--fade);\n      }\n      .balloon.open {\n        opacity: 1;\n        transform: translateY(0);\n        pointer-events: auto;\n      }\n      .balloon .content {\n        display: none;\n      }\n      .balloon .content.show {\n        display: block;\n        font-size: 11.2px !important;\n      }\n\n      /* KV rows inside balloon (easy SVG swap) */\n      .kv {\n        display: grid;\n        gap: 10px;\n      }\n      .kv-row {\n        display: grid;\n        grid-template-columns: 22px 1fr;\n        gap: 5px;\n        align-items: start;\n      }\n      .kv-ico {\n        display: grid;\n        place-items: center;\n        color: #ffc870;\n      }\n      .kv-ico img {\n        width: 18px;\n        height: 18px;\n        display: block;\n        opacity: 0.95;\n      }\n\n      /* Enemies */\n\n      /* .enemies-wrap {\n        margin-top: 14px;\n      } */\n\n      .enemies-grid {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 12px;\n      }\n      .enemy-card {\n        position: relative;\n        background: var(--panel-3);\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n      }\n\n      .small-25 {\n        flex: 0 0 calc(25% - 9px);\n        max-width: calc(25% - 9px);\n      }\n      .small-33 {\n        flex: 0 0 calc(33.333% - 8px);\n        max-width: calc(33.333% - 8px);\n      }\n      .small-50 {\n        flex: 0 0 calc(50% - 6px);\n        max-width: calc(50% - 6px);\n      }\n      .big-50 {\n        flex: 0 0 calc(50% - 6px);\n        max-width: calc(50% - 6px);\n      }\n\n      /* --- Big enemy header grid --- */\n      .hd-quad {\n        display: grid;\n        gap: 6px 12px;\n        grid-template-columns: minmax(0, 1fr) auto;\n        grid-template-areas:\n          \"name exp\"\n          \"lvl  type\";\n        align-items: center;\n        justify-items: start; /* prevent stretching */\n      }\n      .quad-name {\n        grid-area: name;\n        min-width: 0;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      .quad-exp {\n        grid-area: exp;\n        justify-self: end;\n      }\n      .quad-lvl {\n        grid-area: lvl;\n        justify-self: start;\n        padding-left: 0;\n      } /* <— fixes the long pill */\n      .quad-type {\n        grid-area: type;\n        justify-self: end;\n        color: var(--ink-dim);\n      }\n\n      @media (max-width: 980px) {\n        .cards {\n          grid-template-columns: 1fr;\n        }\n        .split {\n          grid-template-columns: 1fr;\n        }\n        .small-25,\n        .small-33,\n        .small-50,\n        .big-50 {\n          flex: 1 1 100%;\n          max-width: 100%;\n        }\n        .hd-main {\n          grid-template-columns: 1fr;\n        }\n      }\n\t\t\t\t\t\t\n/********************* Remove Big/ Small Enemies if empty *******************/\n\t.enemy-card:has(big),\n\t.enemy-card:has(small) {\n\t\tdisplay: none !important;\n\t\t}\n\t\t\n\t@supports selector(:has(*)) {\n\t  /* Small enemies: hide when the name div is empty */\n\t  #enemies-grid .enemy-card[data-size=\"small\"]:has(.small-name:empty) { display: none !important; }\n\n\t  /* Big enemies: hide when the name div is empty */\n\t  #enemies-grid .enemy-card[data-size=\"big\"]  :has(.quad-name:empty)  { display: none; }\n\t}\n\n/********************* Fix overflowing cards *******************/\n/* ===== Others header: 40% (name) | 60% (role), both wrap safely ===== */\n#sec-others .card{ min-width:0; }                 /* grid item can shrink */\n\n#sec-others .hd-basic{\n  display:grid;\n  grid-template-columns: minmax(0,40%) minmax(0,60%); /* ← allows shrink */\n  column-gap:12px;\n  align-items:center;\n  min-width:0;\n}\n\n/* NAME — wrap (no ellipsis) */\n#sec-others .hd-basic .name{\n  min-width:0;\n  white-space: normal !important;   /* override global */\n  overflow: visible !important;\n  text-overflow: clip !important;\n  line-height:1.2;\n  overflow-wrap:anywhere;           /* break long tokens */\n  word-break: break-word;\n  hyphens:auto;\n   display: flex;\n\n}\n\n/* ROLE — wrap too, stays in the 60% column */\n#sec-others .hd-basic .role{\n  min-width:0;\n  margin-left:0 !important;         /* neutralize inline margin-left:auto */\n  white-space: normal !important;\n  overflow: visible !important;\n  text-overflow: clip !important;\n  text-align: right;                  /* or right; wrapping still works */\n  overflow-wrap:anywhere;\n  word-break: break-word;\n  hyphens:auto;\n}\n\n/* (optional) absolute safety if some weird token still tries to spill */\n#sec-others .hd-basic{ overflow-x:hidden; }\n\n\n/* place this at the end of your <style> */\n.tracker-template-container .ic--off{\n  display:inline-grid; \n  place-items:center;\n  width:14px; \n  height:14px; \n  margin-left:6px;\n  border:none; \n  background: none !important;\n  vertical-align: text-bottom;\n  align-items: end;\n  color: #686868;\n}\n\n.ic--off svg{ width:100%; height:100%; display:block; }\n\n\n\n      /******************************** TRACKER NEW!! — END ****************************/",
  "js": "() => {\n  /* ---------- utilities ---------- */\n  const isNode = (x) => x && typeof x.querySelector === \"function\";\n  const toRoot = (...args) => {\n    // Try to find a DOM node in args; otherwise fallback to document.\n    for (const a of args) if (isNode(a)) return a;\n    // Some ST events pass { root: el } or { target: el }\n    for (const a of args) {\n      if (a?.root && isNode(a.root)) return a.root;\n      if (a?.target && isNode(a.target)) return a.target;\n    }\n    return document;\n  };\n\n  /* ---------- tabs (idempotent) ---------- */\n  function setupTabs(root = document) {\n    root.querySelectorAll(\".tab\").forEach((btn) => {\n      if (btn.__tabBound) return;\n      btn.__tabBound = true;\n      btn.addEventListener(\"click\", () => {\n        const sec = btn.dataset.target && root.querySelector(btn.dataset.target);\n        const on = sec?.classList.toggle(\"show\");\n        btn.classList.toggle(\"active\", !!on);\n      });\n    });\n  }\n\n  /* ---------- HP/EXP bars from text (idempotent) ---------- */\n  function renderBarFromText(el, kind) {\n    if (!el || el.__barized) return;           // guard\n    const t = (el.dataset.raw || el.textContent || \"\").trim();\n    const m = t.match(/(\\d+)\\s*\\/\\s*(\\d+)/);\n    if (!m) return;\n    const cur = +m[1], max = +m[2];\n    const pct = Math.max(0, Math.min(100, (cur / max) * 100));\n    el.dataset.raw = t;                         // remember original text\n    el.innerHTML = `<div class=\"labeltext\">${t}</div>`;\n    const bar = document.createElement(\"div\");\n    bar.className = \"bar \" + (kind === \"hp\" ? \"hp\" : \"exp\");\n    const fill = document.createElement(\"span\");\n    fill.style.width = pct + \"%\";\n    bar.appendChild(fill);\n    if (kind === \"hp\") {\n      bar.classList.add(pct < 30 ? \"bad\" : pct < 60 ? \"warn\" : \"ok\");\n    }\n    el.appendChild(bar);\n    el.__barized = true;                        // mark built\n  }\n\n  function initNumericBars(root = document) {\n    root.querySelectorAll(\".hp-line\").forEach((el) => renderBarFromText(el, \"hp\"));\n    root.querySelectorAll(\".exp-line\").forEach((el) => renderBarFromText(el, \"exp\"));\n  }\n\n  /* ---------- balloons (hover/click reveal) ---------- */\n  // One document handler shared by all cards:\n  let docClickBound = false;\n  function setupBalloons(root = document) {\n    root.querySelectorAll(\"[data-card]\").forEach((card) => {\n      if (card.__balloonBound) return;\n      card.__balloonBound = true;\n\n      const balloon = card.querySelector(\".balloon\");\n      const rows = card.querySelectorAll(\"[data-hoverbar]\");\n      let pinned = null, hideTimer;\n\n      const show = (id) => {\n        clearTimeout(hideTimer);\n        if (!balloon) return;\n        card.classList.add(\"raised\");\n        balloon.classList.add(\"open\");\n        balloon.querySelectorAll(\".content\").forEach((c) => c.classList.toggle(\"show\", c.dataset.id === id));\n        card.querySelectorAll(\".ic\").forEach((i) => i.classList.toggle(\"active\", i.dataset.id === id));\n      };\n\n      const hide = () => {\n        if (pinned) return;\n        hideTimer = setTimeout(() => {\n          if (!balloon) return;\n          balloon.classList.remove(\"open\");\n          card.classList.remove(\"raised\");\n          card.querySelectorAll(\".ic\").forEach((i) => i.classList.remove(\"active\"));\n          balloon.querySelectorAll(\".content\").forEach((c) => c.classList.remove(\"show\"));\n        }, 60);\n      };\n\n      rows.forEach((r) => {\n        r.querySelectorAll(\".ic\").forEach((ic) => {\n          ic.addEventListener(\"mouseenter\", () => show(ic.dataset.id));\n          ic.addEventListener(\"click\", (e) => {\n            e.stopPropagation();\n            if (pinned === ic.dataset.id) {\n              pinned = null;\n              hide();\n            } else {\n              pinned = ic.dataset.id;\n              show(pinned);\n            }\n          });\n        });\n        r.addEventListener(\"mouseleave\", hide);\n      });\n    });\n\n    if (!docClickBound) {\n      document.addEventListener(\"click\", (e) => {\n        document.querySelectorAll(\"[data-card]\").forEach((card) => {\n          if (card.contains(e.target)) return;\n          const balloon = card.querySelector(\".balloon\");\n          // clear pinned + hide\n          card.__pinned = null;\n          balloon?.classList.remove(\"open\");\n          card.classList.remove(\"raised\");\n          balloon?.querySelectorAll(\".content\").forEach((c) => c.classList.remove(\"show\"));\n          card.querySelectorAll(\".ic\").forEach((i) => i.classList.remove(\"active\"));\n        });\n      });\n      docClickBound = true;\n    }\n  }\n\n  // UNWRAP ACCIDENTAL <small enemy name> \n  function stripAccidentalSmallPlaceholders(root = document) {\n    // Unwrap any <small enemy name> wrappers and delete them\n    root.querySelectorAll('small[enemy], small[name]').forEach(el => {\n      // move its children before the <small> so structure is preserved\n      const parent = el.parentNode;\n      while (el.firstChild) parent.insertBefore(el.firstChild, el);\n      el.remove();\n    });\n  }\n\n  function hideEmptyEnemyCards(root = document) {\n  const grid = root.querySelector('#enemies-grid');\n  if (!grid) return;\n\n  grid.querySelectorAll('.enemy-card[data-size=\"small\"], .enemy-card[data-size=\"big\"]')\n    .forEach(card => {\n      const nameEl = card.querySelector('.small-name, .quad-name, .name');\n      const name = (nameEl?.textContent || '').trim();\n\n      const isEmpty = !name || name === '—' || name.toLowerCase() === 'x';\n      if (isEmpty) {\n        // Either remove completely...\n        // card.remove();\n\n        // ...or mark hidden so layoutEnemies can ignore it:\n        card.dataset.hidden = '1';\n        card.style.display = 'none';\n      } else {\n        delete card.dataset.hidden;\n        card.style.display = '';\n      }\n    });\n}\n\nfunction hideEmptyOtherCards(root = document) {\n  const wrap = root.querySelector('#sec-others .cards');\n  if (!wrap) return;\n\n  wrap.querySelectorAll('article.card[data-card]').forEach(card => {\n    const nameEl = card.querySelector('.name');\n    // normalize: strip (off) / (off-screen) and zero-widths\n    const raw = (nameEl?.textContent || '')\n      .replace(/\\(\\s*off(?:-screen)?\\s*\\)/ig, '')\n      .replace(/[\\u200B-\\u200D\\uFEFF]/g, '')\n      .trim();\n\n    const isPlaceholder =\n      !raw ||\n      raw === '—' ||\n      /^x$/i.test(raw) ||\n      /^n\\/?a$/i.test(raw) ||\n      /^none$/i.test(raw);\n\n    if (isPlaceholder) {\n      card.dataset.hidden = '1';\n      card.style.display = 'none';\n    } else {\n      card.removeAttribute('data-hidden');\n      card.style.display = '';\n    }\n  });\n}\n\n  /* ---------- small-enemy widths ---------- */\nfunction layoutEnemies(root = document) {\n  const grid = root.querySelector('#enemies-grid');\n  if (!grid) return;\n\n  // only count visible small enemies\n  const small = Array.from(\n    grid.querySelectorAll('.enemy-card[data-size=\"small\"]:not([data-hidden=\"1\"])')\n  );\n  const bigCount = grid.querySelectorAll('.enemy-card[data-size=\"big\"]:not([data-hidden=\"1\"])').length;\n\n  const n = small.length;\n  let cls = \"small-50\";\n  if (n === 1) cls = \"small-50\";\n  else if (n === 2) cls = bigCount >= 1 ? \"small-25\" : \"small-50\";\n  else if (n === 3) cls = \"small-33\";\n  else if (n >= 4) cls = \"small-25\";\n\n  small.forEach(c => {\n    c.classList.remove(\"small-25\", \"small-33\", \"small-50\");\n    c.classList.add(cls);\n  });\n}\n\n\n\n  /* ---------- inline SVG swap ---------- */\n  async function applySvgIcons(root = document) {\n    const els = root.querySelectorAll(\".ic[data-svg], .kv-ico[data-svg], .tab-ico[data-svg]\");\n    for (const el of els) {\n      if (el.__svgApplied) continue;\n      const url = el.getAttribute(\"data-svg\");\n      if (!url) continue;\n      try {\n        const res = await fetch(url, { mode: \"cors\" });\n        const ct = res.headers.get(\"content-type\") || \"\";\n        const txt = await res.text();\n        if (ct.includes(\"image/svg\") || txt.trim().startsWith(\"<svg\")) el.innerHTML = txt;\n        else el.innerHTML = `<img src=\"${url}\" alt=\"\">`;\n      } catch {\n        el.innerHTML = `<img src=\"${url}\" alt=\"\">`;\n      }\n      el.__svgApplied = true;\n    }\n  }\n\n   // swap \"(off-screen)\" or \"(off)\" text for an inline icon, scoped to tracker\nfunction swapOffscreenTokens(root = document) {\n  const scope = root.querySelector('.tracker-template-container') || root;\n  const iconPath = '/scripts/extensions/third-party/SillyTavern-Tracker/icons/off-screen.svg';\n  // only touch these fields\n  scope.querySelectorAll('.name, .role').forEach(host => {\n    // walk text nodes and find matches\n    const walker = document.createTreeWalker(host, NodeFilter.SHOW_TEXT, {\n      acceptNode(n) { return /\\(off(?:-screen)?\\)/i.test(n.nodeValue) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT; }\n    });\n    const hits = [];\n    while (walker.nextNode()) hits.push(walker.currentNode);\n    hits.forEach(txt => {\n      const frag = document.createDocumentFragment();\n      const parts = txt.nodeValue.split(/(\\(off(?:-screen)?\\))/i);\n      parts.forEach(part => {\n        if (!part) return;\n        if (/\\(off(?:-screen)?\\)/i.test(part)) {\n          const span = document.createElement('span');\n          span.className = 'ic ic--off';\n          span.dataset.id = 'off-screen';\n          span.dataset.svg = iconPath;\n          span.setAttribute('aria-label','off-screen');\n          frag.appendChild(span);\n        } else {\n          frag.appendChild(document.createTextNode(part));\n        }\n      });\n      txt.parentNode.replaceChild(frag, txt);\n    });\n  });\n}\n\n  /* ---------- apply everything to a given preview root ---------- */\n  function applyToAll(maybeRoot) {\n    const root = toRoot(maybeRoot);\n    setupTabs(root);\n    stripAccidentalSmallPlaceholders(root);\n    hideEmptyEnemyCards(root); \n    hideEmptyOtherCards(root);\n    initNumericBars(root);\n    setupBalloons(root);\n    layoutEnemies(root);\n    swapOffscreenTokens(root);\n    applySvgIcons(root);\n  }\n\n  /* ---------- ST wiring ---------- */\n  let onPreview;\n  const init = () => {\n    const ctx = SillyTavern?.getContext?.();\n    if (!ctx?.eventSource?.on) {\n      // Fallback: run once if events unavailable\n      applyToAll(document);\n      return;\n    }\n    // Normalize event callback so we always feed a DOM root to applyToAll\n    onPreview = (...args) => applyToAll(toRoot(...args));\n    ctx.eventSource.on(\"TRACKER_PREVIEW_ADDED\",  onPreview);\n    ctx.eventSource.on(\"TRACKER_PREVIEW_UPDATED\", onPreview);\n    // run once for current preview\n    applyToAll(document);\n  };\n\n  const cleanup = () => {\n    const scope = document.querySelector(\".dock-sample\");\n    const listeners = scope ? scope.__dockFloaterListeners : null;\n    if (!listeners) return;\n    listeners.forEach(([el, type, fn]) => el.removeEventListener(type, fn));\n    scope.__dockFloaterListeners = [];\n  };\n\n  return { init, cleanup };\n}"
}